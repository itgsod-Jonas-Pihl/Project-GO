script src="/faye.js"

div#chatbox
  p
    label Nickname:
    input type='text' id='nickname'
    input type='button' value='set nickname' id='nick_button'

    #messages
    input type='text' id='content_message'
    input type='button' onclick ='say_hi()' value='send' id="send_button"

  javascript:
    var client = new Faye.Client('http://#{request.host}:#{request.port}/faye')

    client.subscribe('/messages', function(message) {
      document.getElementById('messages').innerHTML += "<p>" + message.nickname + " : " + message.text + "</p>";
      document.getElementById('messages').scrollTop = 10000;
    });

    document.getElementById("content_message").addEventListener( "keydown", function( e ) {
        var keyCode = e.keyCode || e.which;
        if ( keyCode === 13 ) {
           // enter pressed
           say_hi();
        }
    }, false);

    function say_hi() {
      var text = document.getElementById('content_message').value;
      if( text!= ""){
        var nick = document.getElementById('nickname').value;
        if(nick == "" || nick.length > 12){
          nickname.value="Nick has to be between 1-12"
        }
        else {
          content_message.value= ""
          document.getElementById('content_message').focus()
          client.publish('/messages', {
            text: text, nickname: nick

      });
      }
      }
    }
